<!DOCTYPE html>





<html class="theme-next muse use-motion" lang="zh-CN, en, default">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Play:300,300italic,400,400italic,700,700italic|Press Start 2P:300,300italic,400,400italic,700,700italic|Share Tech Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.3.0',
    sidebar: {"position":"right","width":320,"display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    copycode: {"enable":true,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: 'search.xml'
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="Kubeedge is a CNCF open source project that aims at extending the existing orchestration system (Kubernetes)’s container management capability to the edge. It provides core infrastructure support for">
<meta name="keywords" content="kubeedge, k3s">
<meta property="og:type" content="article">
<meta property="og:title" content="k3s+kubeedge (1) Code Review&#x2F;Debugging Environment Setup">
<meta property="og:url" content="http://yoursite.com/2020/02/01/kubeedge-on-k3s-1/index.html">
<meta property="og:site_name" content="R5by&#39;s Blog">
<meta property="og:description" content="Kubeedge is a CNCF open source project that aims at extending the existing orchestration system (Kubernetes)’s container management capability to the edge. It provides core infrastructure support for">
<meta property="og:locale" content="zh-CN, en, default">
<meta property="og:image" content="https://github.com/kubeedge/kubeedge/raw/master/docs/images/kubeedge_arch.png">
<meta property="og:image" content="https://drive.google.com/uc?export=view&id=1pScAXizLDmS6-K8EgqNnsrPt2kpQlo_t">
<meta property="og:image" content="https://drive.google.com/uc?export=view&id=1f81SmNSQOf96pMF4DYajHNvp0TN_Plea">
<meta property="og:updated_time" content="2020-02-01T23:13:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="k3s+kubeedge (1) Code Review&#x2F;Debugging Environment Setup">
<meta name="twitter:description" content="Kubeedge is a CNCF open source project that aims at extending the existing orchestration system (Kubernetes)’s container management capability to the edge. It provides core infrastructure support for">
<meta name="twitter:image" content="https://github.com/kubeedge/kubeedge/raw/master/docs/images/kubeedge_arch.png">
  <link rel="alternate" href="/atom.xml" title="R5by's Blog" type="application/atom+xml">
  <link rel="canonical" href="http://yoursite.com/2020/02/01/kubeedge-on-k3s-1/">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- gitter chat room -->

<!-- prevent google translate slow down rain effect-->

  <meta name="google" content="notranslate">

  <title>k3s+kubeedge (1) Code Review/Debugging Environment Setup | R5by's Blog</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN, en, default">

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/r5by" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#FD6C6C; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">R5by's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 id="glitch_this" class="site-subtitle" itemprop="description">Welcome</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        <li class="menu-item menu-item-search">
          <a href="javascript:;" class="popup-trigger">
          
            <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
    

    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>

  
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    <div class="reading-progress-bar"></div>

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/01/kubeedge-on-k3s-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="R5by">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="R5by's Blog">
    </span>
      <header class="post-header">

        
          <h2 class="post-title" itemprop="name headline">k3s+kubeedge (1) Code Review/Debugging Environment Setup

              
            
          </h2>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-02-01 11:25:25" itemprop="dateCreated datePublished" datetime="2020-02-01T11:25:25+08:00">2020-02-01</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-02-02 07:13:40" itemprop="dateModified" datetime="2020-02-02T07:13:40+08:00">2020-02-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/edge-computing-cloud-computing/" itemprop="url" rel="index"><span itemprop="name">edge computing, cloud computing</span></a></span>

                
                
              
            </span>
          

          <br>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">Symbols count in article: </span>
              
              <span title="Symbols count in article">8.1k</span>
            </span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">Reading time &asymp;</span>
              
              <span title="Reading time">7 mins.</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2t1YmVlZGdlL2t1YmVlZGdl" title="https://github.com/kubeedge/kubeedge">Kubeedge<i class="fa fa-external-link"></i></span> is a CNCF open source project that aims at extending the existing orchestration system (Kubernetes)’s container management capability to the edge. It provides core infrastructure support for networking, application deployment and metadata synchronization between cloud and edge along with the Kubernetes project. In this series of posts, we’ll see how to deploy Kubeedge on our existing k3s cluster and set up a code review environment where we may set up breakpoint and step-by-step inspect its functionality. This post focuses on the latter part.</p>
<p>For the purpose of reading code and more importantly, understanding and fixing the errors, it’s better to have a debugging environment set up first. As for our deployment, we currently have one PC server as the master host to deploy the cloud part, and two Raspberry Pi 3 as the worker nodes to deploy the edge part. The main components of Kubeedge’s cloud/edge parts can be viewed from the structure pictured in below:</p>
<p><img src="https://github.com/kubeedge/kubeedge/raw/master/docs/images/kubeedge_arch.png" alt="image"></p>
<p>This post is going to demonstrate how to debug the “cloud core” from within the container at deployment. For the edge core, the procedures are similar. You may also build &amp; debug the code from the code directly, but in my case I personally like to have development environment to be close to my deployment (a.k.a in a docker/container execution environment).</p>
<blockquote>
<p>Note: In the previous releases (&lt; v1.0.0) of Kubeedge, the “cloud_core” was named as “edgecontroller” in the code, therefore we will use “edgecontroller” to refer to the “cloud core” in this post because we adopt Kubeedge v1.0.0</p>
</blockquote>
<blockquote>
<p>The following steps assumes your already have a successfully deployed &amp; running k3s cluster (or k8s cluster). All though the master (API server) is required, the worker nodes are not.</p>
</blockquote>
<h2 id="Step-1-Preparation"><a href="#Step-1-Preparation" class="headerlink" title="Step 1. Preparation"></a>Step 1. Preparation</h2><p>First download the source to the master PC, and checkout the version 1.0.0 for later usage:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="variable">$GOPATH</span>/src/github.com/kubeedge</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/kubeedge</span><br><span class="line">git <span class="built_in">clone</span> git@github.com:kubeedge/kubeedge.git</span><br><span class="line"><span class="comment"># If you only want to compile quickly without using go mod, please set GO111MODULE=off (e.g. export GO111MODULE=off) </span></span><br><span class="line"><span class="built_in">cd</span> kubeedge </span><br><span class="line"></span><br><span class="line"><span class="comment"># Check out version 1.0.0</span></span><br><span class="line">git checkout v1.0.0 -b dev-v1.0.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>I’ve found many issues building the code above version 1.0.0, please feel free to test on your own environment and let me know if you may succeed.</p>
</blockquote>
<h2 id="Step-2-Try-to-build-the-cloud-part"><a href="#Step-2-Try-to-build-the-cloud-part" class="headerlink" title="Step 2. Try to build the cloud part"></a>Step 2. Try to build the cloud part</h2><p>Following the instructions from the Kubernetes official document, let’s try to build the cloud image.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make cloudimage</span><br></pre></td></tr></table></figure>

<p>If everything is working as expected, you will get some message like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Successfully built 5f31402ab1ee</span><br><span class="line">Successfully tagged kubeedge/edgecontroller:v1.0.0</span><br></pre></td></tr></table></figure>

<p>However, if you take that image to deploy on the cloud server, you may get lots of trouble. In my next post, I’ll lead you through several pitfalls I encountered when I was trying to deploy it, but for now, let’s continue on our investigation on how to connect the running container to our IDE for debugging/code review.</p>
<h2 id="Step-3-Rebuild-the-cloudimage"><a href="#Step-3-Rebuild-the-cloudimage" class="headerlink" title="Step 3. Rebuild the cloudimage"></a>Step 3. Rebuild the cloudimage</h2><p>For the development and code review, I continue to use GoLand IDE (2019.3). The following debugging strategy is mainly inspired by this <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmpldGJyYWlucy5jb20vZ28vMjAxOC8wNC8zMC9kZWJ1Z2dpbmctY29udGFpbmVyaXplZC1nby1hcHBsaWNhdGlvbnMv" title="https://blog.jetbrains.com/go/2018/04/30/debugging-containerized-go-applications/">post<i class="fa fa-external-link"></i></span>.</p>
<p>First, locate the Dockerfile in the <code>build/cloud</code> path, and replace its content with following:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.12</span>.<span class="number">1</span>-alpine3.<span class="number">9</span> AS builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /go/src/github.com/kubeedge/kubeedge</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN CGO_ENABLED=0 go build -v -o /usr/local/bin/edgecontroller -ldflags="-w -s" \</span></span><br><span class="line"><span class="comment"># github.com/kubeedge/kubeedge/cloud/cmd</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> CGO_ENABLED=0 go build -gcflags <span class="string">"all=-N -l"</span> -v -o /usr/<span class="built_in">local</span>/bin/edgecontroller  \</span></span><br><span class="line"><span class="bash">github.com/kubeedge/kubeedge/cloud/cmd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compile Delve</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk add --no-cache git</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> go get github.com/derekparker/delve/cmd/dlv</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine:<span class="number">3.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For debug</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">2345</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> GOARCHAIUS_CONFIG_PATH /etc/kubeedge/cloud</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow delve to run on Alpine based containers.</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk add --no-cache libc6-compat</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/etc/kubeedge/certs"</span>, <span class="string">"/etc/kubeedge/cloud/conf"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /usr/<span class="built_in">local</span>/bin/edgecontroller /usr/<span class="built_in">local</span>/bin/edgecontroller</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /go/bin/dlv /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/dlv"</span>, <span class="string">"--listen=:2345"</span>, <span class="string">"--headless=true"</span>, <span class="string">"--api-version=2"</span>, <span class="string">"exec"</span>, <span class="string">"/usr/local/bin/edgecontroller"</span>]</span></span><br></pre></td></tr></table></figure>

<p>Then rebuild the cloudimage from the source project root and save that new image to your docker hub. If you may prefer to skip this step, feel free to grab mine from here <code>r5by/kubeedge_edgecontroller_debug:v1.0.0</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd to your project root and rebuild the cloud image</span></span><br><span class="line">build cloudimage</span><br><span class="line"></span><br><span class="line"><span class="comment"># login to your docker accnt and save the image</span></span><br><span class="line">docker login -u &lt;user_name&gt;</span><br><span class="line">docker tag kubeedge/edgecontroller:v1.0.0 &lt;user_name&gt;/kubeedge_edgecontroller_debug:v1.0.0</span><br><span class="line">docker push &lt;user_name&gt;/kubeedge_edgecontroller_debug:v1.0.0</span><br></pre></td></tr></table></figure>

<h2 id="Step-4-Connect-with-the-debugger"><a href="#Step-4-Connect-with-the-debugger" class="headerlink" title="Step 4. Connect with the debugger"></a>Step 4. Connect with the debugger</h2><p>The final step is to connect our IDE debugging tool with the container after deployment. First <code>cd build/cloud</code> then modify your <code>07-deployment.yaml</code> as following:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">    kubeedge:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      k8s-app:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">      kubeedge:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      annotations:</span></span><br><span class="line">        <span class="string">container.apparmor.security.beta.kubernetes.io/edgecontroller:</span> <span class="string">unconfined</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        k8s-app:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">        kubeedge:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kubeconfig</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">alpine:3.9</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">kubeconfig</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kubeedge/cloud</span></span><br><span class="line"><span class="attr">        args:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">/bin/sh</span></span><br><span class="line"><span class="bullet">        -</span> <span class="bullet">-c</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">|</span></span><br><span class="line"><span class="string">          apk --update add --no-cache coreutils &amp;&amp; cat | tee /etc/kubeedge/cloud/kubeconfig.yaml &lt;&lt;EOF</span></span><br><span class="line"><span class="string"></span><span class="attr">          apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">          kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">          clusters:</span></span><br><span class="line"><span class="attr">          - name:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">                      cluster:</span></span><br><span class="line"><span class="attr">              certificate-authority-data:</span> <span class="string">$(cat</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span> <span class="string">| base64 -w 0)</span></span><br><span class="line"><span class="string"></span><span class="attr">          users:</span></span><br><span class="line"><span class="attr">          - name:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">            user:</span></span><br><span class="line"><span class="attr">              token:</span> <span class="string">$(cat</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token)</span></span><br><span class="line"><span class="attr">          contexts:</span></span><br><span class="line"><span class="attr">          - name:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">            context:</span></span><br><span class="line"><span class="attr">              cluster:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">              user:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">          current-context:</span> <span class="string">kubeedge</span></span><br><span class="line">          <span class="string">EOF</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">r5by/kubeedge_edgecontroller:v1.0.0</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          capabilities:</span></span><br><span class="line"><span class="attr">            add:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">SYS_PTRACE</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">cloudhub</span></span><br><span class="line"><span class="attr">          protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">        resources:</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">200</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">1</span><span class="string">Gi</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">512</span><span class="string">Mi</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">conf</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kubeedge/cloud/conf</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">certs</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kubeedge/certs</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">kubeconfig</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/kubeedge/cloud</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">      serviceAccount:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">conf</span></span><br><span class="line"><span class="attr">        configMap:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">certs</span></span><br><span class="line"><span class="attr">        secret:</span></span><br><span class="line"><span class="attr">          secretName:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kubeconfig</span></span><br><span class="line"><span class="attr">        emptyDir:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>

<p>Then create (if not existing) a <code>08-service.yaml</code> file and copy-paste the following content to it:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">    kubeedge:</span> <span class="string">edgecontroller</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">cloudhub</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">debug</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">2345</span></span><br><span class="line"><span class="attr">    nodePort:</span> <span class="number">32345</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">kubeedge</span></span><br><span class="line"><span class="attr">    kubeedge:</span> <span class="string">edgecontroller</span></span><br></pre></td></tr></table></figure>

<p>Edit a shell script as following within <code>build/cloud</code> and execute it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> resource <span class="keyword">in</span> $(ls *.yaml)</span><br><span class="line">    <span class="keyword">do</span> k3s kubectl create -f <span class="variable">$resource</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Note</strong>: To use this script, you need to have a k3s master configured properly and secrets files generated. If you are not sure how to do so, please refer to my next post on how to deploy the Kubeedge cloud core then come back to follow the rest.</p>
</blockquote>
<p>Verify the edgecontroller service’s up with the following commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">k3s kubectl get pod -n kubeedge</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="comment"># NAME                              READY   STATUS    RESTARTS   AGE</span></span><br><span class="line"><span class="comment"># edgecontroller-85cdc9cf8f-2p8mj   1/1     Running   0          11s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check its log</span></span><br><span class="line">k3s kubectl logs edgecontroller-85cdc9cf8f-2p8mj -n kubeedge -c edgecontroller</span><br><span class="line"><span class="comment"># Output:</span></span><br><span class="line"><span class="comment"># API server listening at: [::]:2345</span></span><br></pre></td></tr></table></figure>

<p>Now configure your IDE as following:</p>
<p><img src="https://drive.google.com/uc?export=view&id=1pScAXizLDmS6-K8EgqNnsrPt2kpQlo_t" alt="image"></p>
<p>Click the debug button and start code walking:</p>
<p><img src="https://drive.google.com/uc?export=view&id=1f81SmNSQOf96pMF4DYajHNvp0TN_Plea" alt="image"></p>
<h2 id="Step-5-Trouble-Shooting"><a href="#Step-5-Trouble-Shooting" class="headerlink" title="Step 5. Trouble Shooting"></a>Step 5. Trouble Shooting</h2><p>It is likely that you may confront several errors until successfully connect your debugger to the container. If that happens, check the following tips to see whether it may help you out:</p>
<blockquote>
<p>1) The pod was failed due to some “CrushLoopBackOff” status or stuck at “Initializing” </p>
</blockquote>
<p>Check your CoreDNS service first, it’s likely that it’s not working so the pulling from public repository failed or stuck. Using the following commands to check:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 'kc' alias 'k3s kubectl'</span></span><br><span class="line"><span class="comment"># Verify your coredns is up&amp;running</span></span><br><span class="line">kc get pod --all-namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test your dns resolver</span></span><br><span class="line">kc run -i --tty busybox --image=busybox --restart=Never -- sh</span><br><span class="line"><span class="comment"># Within the busybox</span></span><br><span class="line">vi /etc/resolv.conf <span class="comment">#nameserver, etc.</span></span><br><span class="line">nslookup www.google.com <span class="comment">#nslookup test</span></span><br><span class="line"><span class="comment"># You should be able to see the server and address listed, if not, use the following commands to:</span></span><br><span class="line"><span class="comment"># 1) Verify each Chain of the iptable is set at "ACCEPT" flag</span></span><br><span class="line">iptables -L | grep INPUT  <span class="comment"># check respectively INPUT/OUTPUT/FORWARD in your iptable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) If the above check passed, flush the iptables with following commands to see if error messages are gone</span></span><br><span class="line">iptables --flush</span><br><span class="line">iptables -tnat --flush</span><br><span class="line"></span><br><span class="line"><span class="comment"># If solved, delete the busybox</span></span><br><span class="line">kc delete pod busybox</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2) If you see more errors, please refer to my next post on setting up kubeedge cloud part to see if they may be gone. Some errors may be caused by incorrect configurations/running environment.</p>
</blockquote>

    </div>

    
    
    
    
      <div>
        <div id="reward-container">
  <div>ㄟ(●′ω`●)ㄏ</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block">
        <img src="/images/wechat.png" alt="R5by WeChat Pay">
        <p>WeChat Pay</p>
      </div>

  </div>
</div>

      </div>

    <footer class="post-footer">
          
        
        <div class="post-tags">
            <a href="/tags/kubeedge-k3s/" rel="tag"># kubeedge, k3s</a>
          
        </div>
        <div class="post-widgets">
        
          <div class="wp_rating">
            <div id="wpac-rating"></div>
          </div>
        

        

        
        </div>
      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
              <a href="/2019/10/31/k3s-dev-2/" rel="next" title="k3s Dev (2) Vagrant + VirtualBox Dev.">
                <i class="fa fa-chevron-left"></i> k3s Dev (2) Vagrant + VirtualBox Dev.
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
              <a href="/2020/02/02/kubeedge-on-k3s-2/" rel="prev" title="k3s+kubeedge (2) Deploy the Cloud Core (edgecontroller)">
                k3s+kubeedge (2) Deploy the Cloud Core (edgecontroller) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  


        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <!-- customize link to "about me" -->
    <a href="/about/" rel="section">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="R5by"></a>
  <p class="site-author-name" itemprop="name">R5by</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3I1Ynk=" title="GitHub &rarr; https://github.com/r5by"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-1-Preparation"><span class="nav-number">1.</span> <span class="nav-text">Step 1. Preparation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-2-Try-to-build-the-cloud-part"><span class="nav-number">2.</span> <span class="nav-text">Step 2. Try to build the cloud part</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-3-Rebuild-the-cloudimage"><span class="nav-number">3.</span> <span class="nav-text">Step 3. Rebuild the cloudimage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-4-Connect-with-the-debugger"><span class="nav-number">4.</span> <span class="nav-text">Step 4. Connect with the debugger</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-5-Trouble-Shooting"><span class="nav-number">5.</span> <span class="nav-text">Step 5. Trouble Shooting</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">R5by</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    
    <span title="Symbols count total">56k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    
    <span title="Reading time total">51 mins.</span>
</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/reading_progress/reading_progress.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  <script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>

  
  <script src="/js/schemes/muse.js?v=7.3.0"></script>


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>



  <script src="/js/next-boot.js?v=7.3.0"></script>

  

  
  <script src="/js/exturl.js?v=7.3.0"></script>

  


  




















  <script>
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id: 21460,
      el: 'wpac-rating',
      color: 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  </script>



  <script src="/js/local-search.js?v=7.3.0"></script>













    
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">
<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

<script>
  var gitalk = new Gitalk({
    clientID: 'e6801dba21d5153fca76',
    clientSecret: '2b1f89619ca1f0c197aea0e432c0c71b9008946c',
    repo: 'r5by.github.io',
    owner: 'r5by',
    admin: ['r5by'],
    id: md5(location.pathname),
      language: 'en',
    
    distractionFreeMode: 'true'
  });
  gitalk.render('gitalk-container');
</script>

    <!-- 页面点击小红心 -->


<!-- 点击烟花效果 -->


<!-- Digital rain background -->


<!-- matrix digital rain -->

  <div class="background" style="position: fixed; right: 0px; bottom: 0px;min-width: 100%;min-height: 100%;height: auto;width: auto;z-index: -1;">
      <rain></rain>
  </div>
  <script type="text/javascript" src="/js/mtxdigitalrain.js"></script>


<!-- subtitle text changing -->
<script type="text/javascript" src="/js/decryption.js"></script>

</body>
</html>
